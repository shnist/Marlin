/*!
* jQuery Custom Select Manager function
* Copyright 2011-2012, Ray Brooks
* Requires jQuery Core 1.4+ - http://www.jquery.com/
* Dual licensed under the MIT or GPL Version 2 licenses.
*/
(function(b){var j="ontouchstart"in document.documentElement?"touchend":"click";b.fn.flyweightCustomSelect=function(k){var a={},e=b.fn.flyweightCustomSelect.menu||null,s=function(){var d=null,c=!1,h=null,i=null,k=0,g=[],p=function(){g=b.map(b(a.optionfilter,d),function(f){var a=b(f),d=a[0].index;b.browser.msie&&"OPTGROUP"===f.nodeName.toUpperCase()&&(d=null);return{type:f.nodeName.toUpperCase(),selectIndex:d,text:a.text(),value:a.attr("value"),group:a.attr("label")}})},r=function(){for(var f=0,b='<ul class="'+a.classes.menu.list.base+'">',d=function(f,b){return'<li><a  class="'+a.classes.menu.listitem.base+'"data-index="'+f+'" href="#">'+b+"</a></li>"};f<g.length;)if("OPTGROUP"===g[f].type){b+='<li class="'+a.classes.menu.group.base+'"><span>'+g[f].group+"</span><ul>";for(f+=1;f<g.length&&"OPTGROUP"!==g[f].type;)b+=d(g[f].selectIndex,g[f].text),f+=1;b+="</ul></li>"}else b+=d(g[f].selectIndex,g[f].text),f+=1;h.html(b+"</ul>")},m=function(f){d.value=g[f].value;d.selectedIndex=g[f].selectIndex;i.find("span."+a.classes.placeholder.text.base).text(g[f].text);b(d).trigger("change")},n=function(f){m(f);f=h.find('a[data-index="'+g[f].selectIndex+'"]');h.find("ul").scrollTop(0);h.find("a").removeClass(a.classes.menu.listitem.focus);0<f.length&&(f.addClass(a.classes.menu.listitem.focus),h.find("ul").scrollTop(f.position().top))},l=function(f,a){for(var b=g.length-1;0<b&&g[b][f]!==a;)b-=1;return b},v=function(f,a){for(;a<d.options.length;){if(d[a].text.toUpperCase().charCodeAt(0)===f)return n(l("selectIndex",a)),!0;a+=1}return!1},s=function(a){a.stopPropagation();a=a.target;if("A"!==a.nodeName.toUpperCase())return!1;e.touchMoved||(m(l("selectIndex",parseInt(a.getAttribute("data-index"),10))),e.close(),i.focus());return!1},t=function(b){b.stopPropagation();i.addClass(a.classes.placeholder.container.focus);e.touchMoved=!1;e.lastTouch=b.originalEvent.touches[0].pageY;return!1},u=function(b){e.touchMoved=!0;var d=h.find("ul."+a.classes.menu.list.base),c=h.find("span."+a.classes.menu.scroll.base),n=d.attr("scrollTop")+e.lastTouch-b.originalEvent.touches[0].pageY,l=5+n*c.height()/d.height(),l=Math.max(5,l),l=Math.min(d.height()-c.height()-10,l);d.scrollTop(n);c.css("top",l);e.lastTouch=b.originalEvent.touches[0].pageY},o=function(a){for(var b=g.length;b;)b-=1,g[b].selectIndex===d.selectedIndex+a&&(n(b),b=0)};return function(){h=b('<div class="'+a.classes.menu.container.base+'" />');h.bind(j,s);h.bind("touchstart",t);h.bind("touchmove",u);b("body").append(h);return{bondToSelect:function(a,b){i=a;d=b},open:function(){if(!c){p();r();var f=i.width();h.width(f);var f=h.outerHeight(),e=i.offset().top,g=i.height(),m=window.innerHeight?window.innerHeight:b(window).height(),q=0,o=!0;e+g+f<m?q=e+g:e-f>b(window).scrollTop()?(q=e-f,o=!1):(q=e+g,e=Math.min(f,m-(q-b(window).scrollTop())),h.find("ul."+a.classes.menu.list.base).height(e),"touchend"===j&&(g=b('<span class="'+a.classes.menu.scroll.base+'"></span>'),g.height(parseInt(Math.pow(e,2)/f,10)-10),h.append(g)));h.css({left:i.offset().left+"px",top:q+"px"});o?(h.addClass(a.classes.menu.container.dropdown),i.addClass(a.classes.placeholder.container.dropdown)):(h.addClass(a.classes.menu.container.dropup),i.addClass(a.classes.placeholder.container.dropup));h.addClass(a.classes.menu.container.open);i.addClass(a.classes.placeholder.container.open).focus();k=l("selectIndex",d.selectedIndex);n(k);return c=!0}return!1},close:function(){h.removeClass(a.classes.menu.container.open+" "+a.classes.menu.container.dropdown+" "+a.classes.menu.container.dropup);if(i&&(i.removeClass(a.classes.placeholder.container.open+" "+a.classes.placeholder.container.dropdown+" "+a.classes.placeholder.container.dropup),"touchend"===j))i[0].className=a.classes.placeholder.container.base;c=!1},destroy:function(){h.unbind();h.remove()},reset:function(){n(k);this.close()},isOpen:function(){return c},scrollDown:function(){this.open()||o(1)},scrollUp:function(){this.open()||o(-1)},pageDown:function(){this.open()||o(10)},pageUp:function(){this.open()||o(-10)},search:function(a){this.open();a=a.toUpperCase().charCodeAt(0);v(a,d.selectedIndex+1)||v(a,0)},getSelect:function(){return d},getCurrentPlaceHolder:function(){return i},touchMoved:!1,lastTouch:0}}()},u=function(d){var c,h=function(){return"touchend"!==j?function(a){a.stopPropagation();a.preventDefault();e.open()||e.close()}:function(b){b.stopPropagation();b.preventDefault();if(b=e.getCurrentPlaceHolder())b[0].className=a.classes.placeholder.container.base;e.bondToSelect(c,d);e.open()||e.close()}}(),i=function(a){a.stopPropagation();return!1},k=function(d){d.stopPropagation();var c=d.keyCode;(c===a.keymap.left||c===a.keymap.right||c===a.keymap.up||c===a.keymap.down||c===a.keymap.enter||c===a.keymap.space)&&d.preventDefault();switch(!0){case c===a.keymap.left:case c===a.keymap.up:e.scrollUp();break;case c===a.keymap.right:case c===a.keymap.down:e.scrollDown();break;case c===a.keymap.pgup:e.pageUp();break;case c===a.keymap.pgdn:e.pageDown();break;case c===a.keymap.enter:case c===a.keymap.space:b(this).trigger(j);break;case c===a.keymap.tab:e.close();break;case c===a.keymap.escape:e.reset();break;case 48<=c&&59>=c:case 65<=c&&90>=c:case 97<=c&&122>=c:e.search(String.fromCharCode(c))}},g=function(b){b.stopPropagation();e.bondToSelect(c,d);c.addClass(a.classes.placeholder.container.focus)},p=function(b){b.stopPropagation();c[0].className=a.classes.placeholder.container.base},r=function(){var e=function(){b(d).removeAttr("disabled");b(d).attr("tabindex")&&a.tabindex?c.attr("tabindex",b(d).attr("tabindex")):c.attr("tabindex",0);c.removeClass(a.classes.placeholder.container.disabled);c.bind(j,h)};return"touchend"!==j?function(){e();c.unbind("focus").bind("focus",g);c.unbind("blur").bind("blur",p);c.keydown(k)}:function(){e();c.unbind("touchstart").bind("touchstart",i)}}(),m=function(){var e=function(){b(d).attr("disabled","disabled");!a.tabindex||c.removeAttr("tabindex");c.addClass(a.classes.placeholder.container.disabled);c.unbind(j).bind(j,function(){return!1})};return"touchend"!==j?function(){e();c.unbind("focus").bind("focus",function(){this.blur();return!1});c.unbind("blur");c.unbind("keydown")}:function(){e();c.unbind("touchstart")}}();return function(){c=t(d);r();b(d).after(c);b(d).hide();return{enable:function(){r()},disable:function(){m()},destroy:function(){c.unbind();c.remove();b(d).removeAttr("disabled").show()}}}()},p={init:function(d){var c=function(){if("touchend"!==j)return function(){e.isOpen()&&e.reset()};var a;b(document).bind("touchstart",function(){a=!1});b(document).bind("touchmove",function(){a=!0});return function(){e.isOpen()&&!1===a&&e.reset()}}();a=b.extend({},b.fn.flyweightCustomSelect.settings,d);if(null===e)e=b.fn.flyweightCustomSelect.menu=new s,b(document).bind(j,c);return this.each(function(){b(this).data("placeHolder")||b(this).data("placeHolder",new u(this))})},destroy:function(){e.destroy();e=b.fn.flyweightCustomSelect.menu=null;b(document).unbind(j);b(document).unbind("touchmove");b(document).unbind("touchstart");return this.each(function(){b(this).data("placeHolder").destroy();b(this).data("placeHolder",null)})},enable:function(){return this.each(function(){b(this).data("placeHolder").enable()})},disable:function(){return this.each(function(){b(this).data("placeHolder").disable()})}},t=function(){return b.browser.msie&&7>parseInt(b.browser.version,10)?function(d){return b('<div class="'+a.classes.placeholder.container.base+" "+d.className+'"><a href="#" aria-owns="'+d.id+'" role="button" href="#" aria-haspopup="true" id="'+d.id+'-button"><span class="'+a.classes.placeholder.text.base+'">'+d.options[d.selectedIndex].text+'</span><span class="'+a.classes.placeholder.arrow.base+'"></span></a></div>')}:function(d){return b('<a href="#" aria-owns="'+d.id+'" class="'+a.classes.placeholder.container.base+" "+d.className+'" role="button" href="#" aria-haspopup="true" id="'+d.id+'-button"><span class="'+a.classes.placeholder.text.base+'">'+d.options[d.selectedIndex].text+'</span><span class="'+a.classes.placeholder.arrow.base+'"></span></a>')}}();if(p[k])return p[k].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof k||!k)return p.init.apply(this,arguments);b.error("Method "+k+" does not exist on jQuery.flyweightCustomSelect")};b.fn.flyweightCustomSelect.settings={classes:{placeholder:{container:{base:"fwselect",open:"fwselect-open",dropdown:"fwselect-drop-down",dropup:"fwselect-drop-up",focus:"fwselect-focus",disabled:"fwselect-disabled"},text:{base:"fwselect-text"},arrow:{base:"fwselect-arrow"}},menu:{container:{base:"fwselect-menu",open:"fwselect-menu-open",dropdown:"fwselect-menu-drop-down",dropup:"fwselect-menu-drop-up"},list:{base:"fwselect-menu-list"},listitem:{base:"fwselect-menu-listitem",focus:"fwselect-menu-listitem-focus"},group:{base:"fwselect-menu-group"},scroll:{base:"fwselect-menu-scroll"}}},optionfilter:"option,optgroup",tabindex:!1,keymap:{left:37,right:39,up:38,down:40,enter:13,space:32,tab:9,pgup:33,pgdn:34,escape:27}}})(jQuery);