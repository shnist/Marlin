include includes/header
div#page
	div#content
		h1= name
		// export data form
		form(method='post', id='export')
			fieldset
				input(type='submit', name='exporting', value='Export all data')
		include includes/latest_information
		include includes/navigation
		-if (selected === null)
			-var chosen = []
			-each rule, i in statistics[0]
				-if ((i + 1) <= 4)
					-chosen.push(rule)
		// http best performance graph
		h2.rule-title Best Performing HTTP rules
		-if(selected !== null && selected.length > 1)
			div.alerts
				-var isFirst = true
				-each latestRule, i in selected[0]
					-each formerRule, j in selected[1]
						if (i === j)
							-if((latestRule.score - formerRule.score) <= -10)
								-if (isFirst === true)
									h2 Alerts
									p.error
										em= latestRule.name
										= ' has dropped by over 10 points!'
									-isFirst = false
								-else
									p.error
										em= latestRule.name
										= ' has dropped by over 10 points!'
							else if((latestRule.score - formerRule.score) >= 10)
								-if (isFirst === true)
									h2 Alerts
									p.success= 'Great! '
										em= latestRule.name
										= ' has increased by over 10 points!'
									-isFirst = false
								-else
									p.success= 'Great! '
										em= latestRule.name
										= ' has increased by over 10 points!'
		-else
			-if (statistics.length > 1)
				-var isFirst = true
				div.alerts
					-each latestRule, j in chosen
						-each formerRule, k in statistics[1]
							if(latestRule.id === formerRule.id)
								-if((latestRule.score - formerRule.score) <= -10)
									-if (isFirst === true)
										h2 Alerts
										p.error
											em= latestRule.name
											= ' has dropped by over 10 points!'
										-isFirst = false
									-else
										p.error
											em= latestRule.name
											= ' has dropped by over 10 points!'
								else if((latestRule.score - formerRule.score) >= 10)
									-if (isFirst === true)
										h2 Alerts
										p.success= 'Great! '
											em= latestRule.name
											= ' has increased by over 10 points!'
										-isFirst = false
									-else
										p.success= 'Great! '
											em= latestRule.name
											= ' has increased by over 10 points!'
		div#chart-best.graph
			table.statistics
				caption A table to show the best performing HTTP rules
				thead
					tr
						th Time of Commit
						-if (selected !== null)
							-each rule, i in selected[0]
								th= rule.name
						-else 
							-each rule, i in chosen
								th= rule.name
				tbody
					-for(var i = 0; i < statistics.length; i = i + 1)
						tr
							td= new Date(reports[i].date).toLocaleDateString() + '&nbsp;' + new Date(reports[i].date).toLocaleTimeString()
							-if(selected !== null)
								-each rule, j in selected[i]
									td= rule.score
							-else
								-each rule, j in statistics[i]
									-if ((j + 1) <=  4)
										td= rule.score
		// form for selecting different rules
		form(method='post', class='rule-options')
			fieldset(class='date collapsible')
				h3.first Change the date range
					span.arrow
				ul
					li
						label(for='http-date-from-best') From:
						-var yesterday = new Date(new Date().getTime() - (1000*3600*24)), tomorrow = new Date(new Date().getTime() + (1000*3600*24));
						input(type='text', name='date-from', id='http-date-from-best', class='has-date-picker date-from', value=(yesterday.getMonth() + 1) + '/' + yesterday.getDate() + '/' + yesterday.getFullYear())
					li
						label(for='http-date-to-best') To:
						input(type='text', name='date-to', id='http-date-to-best', class='has-date-picker date-to', value=(tomorrow.getMonth() + 1) + '/' + tomorrow.getDate() + '/' + tomorrow.getFullYear())
			fieldset.collapsible
				h3.last Update the rules shown
					span.arrow
				ul.rule-list
					li.hidden
						input(type='text', name='chart-type', value='best', readonly='readonly')
					li.hidden
						input(type='text', name='project', value=name, readonly='readonly')
					-var checked=false
					-each rule, i in statistics[0]
						-if (selected !== null)
							-each name in selected[0]
								-if (name.id === rule.id)
									-checked=true
						-else
							-if ((i + 1) <= 4)
								-checked=true
							-else
								-checked=false
						li
							-if (checked === false)
								input(type='checkbox', name='rules[]', value=rule.id, id=rule.id)
								label(for=rule.id)= rule.name
							-else
								input(type='checkbox', name='rules[]', value=rule.id, id=rule.id, checked='checked')
								label(for=rule.id)= rule.name
								-checked=false
			input(type="submit", name="update", value="Update Best Performing")
//footer
include includes/footer
//scripts
include includes/scripts